<html>
<body style="
    background-image: url(file:///Users/wrongway/Documents/dev/game/im/back.png);
    width: 1590;
    height: 530;
    background-repeat: repeat;
    background-size: cover;
">

<script>
    var xDelta = 0;
    var yDelta = 0;
    var xPos = 0;
    var yPos = 0;
    
    document.addEventListener('keydown', function(event) {
        console.log('Key: ', event.key);
        console.log('keyCode: ', event.keyCode);
    
        // Left
        if (event.keyCode == 37) {
            xPos = -100;
            xDelta = -2;
        }

        // Right
        if (event.keyCode == 39) {
            xPos = 100;
            xDelta = 2;
        }

        // Up
        if (event.keyCode == 38) {
            yPos = 100;
            yDelta = 2;
        }

        // Down
        if (event.keyCode == 40) {
            yPos = -100;
            yDelta = -2;
        }
    });
    
    class myObject {

        constructor(type, bottom, left, backgroundSize="contain", position="absolute") {
            this.type = type;
            this.id = this.generateId();
            this.divElement = document.createElement('div');
            this.divElement.setAttribute('id', this.id);
            document.body.appendChild(this.divElement);

            this.y = parseInt(bottom);
            this.x = parseInt(left);
            this.backgroundSize = backgroundSize;
            this.backgroundPosition = position;
            this.width = parseInt("100px");
            this.height = parseInt("100px");

            switch (this.type) {
                case "stone":
                    this.backgroundImage = "url(file:///Users/wrongway/Documents/dev/game/im/floor.png)";    
                    break;
                case "hero":
                    this.backgroundImage = "url(file:///Users/wrongway/Documents/dev/game/im/pers3.png)";
                    break;
                case "flag":
                    this.backgroundImage = "url(file:///Users/wrongway/Documents/dev/game/im/flag.png)";
                    break;
                case "spikes":
                    this.backgroundImage = "url(file:///Users/wrongway/Documents/dev/game/im/spikes.png)";
                    break;
            }

        }

        static counter = 0;
        generateId() {
            if (this.type == "hero") {
                return "hero";
            }
            else {
                let result = myObject.counter;
                myObject.counter += 1;
                return "obj" + result;
            }
        }

        myRender() {
            let style = this.divElement.style;
            style.width = this.width + "px";
            style.height = this.height + "px";
            style.backgroundSize = this.backgroundSize;
            style.backgroundImage = this.backgroundImage;
            style.bottom = this.y + "px";
            style.left = this.x + "px";
            style.position = this.backgroundPosition;
        }
    }

    var objects = [];

    for (var i = 0; i < 1600; i += 100) {
        var stone = new myObject("stone", "0px", i + "px");
        if (i == 500) {
            continue;
        }
        objects.push(stone);  
    }

    let hero = new myObject("hero", "100px", "100px");
    objects.push(hero);

    let flag = new myObject("flag", "100px", "1300px");
    objects.push(flag);

    var spikes = new myObject("spikes", "0px", "500px");
    objects.push(spikes);

    var spikes = new myObject("spikes", "100px", "300px");
    objects.push(spikes);

    var stone = new myObject("stone", "200px", "300px");
    objects.push(stone);

    var stone = new myObject("stone", "200px", "500px");
    objects.push(stone);

    var stone = new myObject("stone", "300px", "700px");
    objects.push(stone);

    var spikes = new myObject("spikes", "100", "800px");
    objects.push(spikes);
    
    var spikes = new myObject("spikes", "100", "900px");
    objects.push(spikes);

    var spikes = new myObject("spikes", "100", "1000px");
    objects.push(spikes);

    function render() {
        for (var i = 0; i < objects.length; i++) {
            var obj = objects[i];
            obj.myRender();
        }
    }

    function moveX() {
        if (xPos != 0) {
            xPos = xPos - xDelta;
            hero.x += xDelta;
        }
        // console.log(hero.x);
    }

    function moveY() {
        if (yPos != 0) {
            yPos = yPos - yDelta;
            hero.y += yDelta;
        }
        // console.log(hero.y)
    }

    function move() {
        moveX();
        moveY();
    }

    function calcArea(x1, dx1, y1, dy1, x2, dx2, y2, dy2) {
        if (x1 > x2) {
            x1 = [x2, x2 = x1][0];
            y1 = [y2, y2 = y1][0];
            dx1 = [dx2, dx2 = dx1][0];
            dy1 = [dy2, dy2 = dy1][0];
        }
        let dX = Math.max(x1 + dx1 - x2, 0);
        if (y1 > y2) {
            return dX * Math.max(y2 + dy2 - y1, 0);
        } else {
            return dX * Math.max(y1 + dy1 - y2, 0);
        }
    }

    function collision() {
        for (var i = 0; i < objects.length; ++i) {
            let obj = objects[i];
            if (obj.type == "stone") {
                let area = calcArea(hero.x, hero.width, hero.y, hero.height, 
                    obj.x, obj.width, obj.y, obj.height);
                if (area > 0) {
                    console.log("Collision with " + obj.id);
                }
            }
        }
    }

    var moveSystem = setInterval(move, 5);
    var renderSystem = setInterval(render, 5);
    var collisionSystem = setInterval(collision, 5);
    
    </script>
</body></html>